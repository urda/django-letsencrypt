# -*- coding: utf-8 -*-
# Generated by Django 1.10.4 on 2017-01-13 10:40
from __future__ import unicode_literals

from django.db import (
    connection,
    migrations,
)


ORIGINAL_NAME = 'AcmeChallenge'
ORIGINAL_TABLE = 'letsencrypt_acmechallenge'
MIGRATION_NAME = 'AcmeChallengeMigrationModel'


def table_exists(target_table):
    """
    Determine if an old ACME table exists

    Pulled from source: https://gist.github.com/rctay/527113

    :return: 'True' if it does, 'False' otherwise
    """

    try:
        return target_table in connection.introspection.table_names()
    except:
        raise Exception(
            "Unable to determine if {table} exists!".format(
                table=target_table,
            )
        )


def move_existing_table(apps, schema_editor):
    """Move the existing ACME table if exists"""
    if table_exists(ORIGINAL_TABLE):
        migrations.RenameModel(ORIGINAL_NAME, MIGRATION_NAME)


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.RunPython(move_existing_table, reverse_code=None),
    ]
